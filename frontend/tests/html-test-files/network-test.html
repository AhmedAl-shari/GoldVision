<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GoldVision - Network Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #1e40af;
        color: white;
        padding: 20px;
        text-align: center;
        margin: 0;
      }
      .container {
        max-width: 400px;
        margin: 0 auto;
      }
      .test-box {
        background-color: #3b82f6;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }
      .status {
        font-weight: bold;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .success {
        background-color: #10b981;
      }
      .error {
        background-color: #ef4444;
      }
      .loading {
        background-color: #f59e0b;
      }
      .main-app-link {
        background-color: #10b981;
        color: white;
        padding: 15px 30px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: bold;
        display: inline-block;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ† GoldVision</h1>
      <h2>Network Test</h2>

      <div class="test-box">
        <h3>ğŸ“± Device Info</h3>
        <p>Screen: <span id="screen-size">Loading...</span></p>
        <p>User Agent: <span id="user-agent">Loading...</span></p>
      </div>

      <div class="test-box">
        <h3>ğŸŒ Network Test</h3>
        <p>
          Frontend:
          <span id="frontend-status" class="status loading">Testing...</span>
        </p>
        <p>
          Backend:
          <span id="backend-status" class="status loading">Testing...</span>
        </p>
        <p>
          Prophet:
          <span id="prophet-status" class="status loading">Testing...</span>
        </p>
      </div>

      <div class="test-box">
        <h3>ğŸ”— API Test</h3>
        <p>
          CSRF Token:
          <span id="csrf-status" class="status loading">Testing...</span>
        </p>
        <p>
          Health Check:
          <span id="health-status" class="status loading">Testing...</span>
        </p>
      </div>

      <div class="test-box">
        <h3>ğŸ“Š JavaScript Test</h3>
        <p>
          Basic JS:
          <span id="js-status" class="status loading">Testing...</span>
        </p>
        <p>
          Fetch API:
          <span id="fetch-status" class="status loading">Testing...</span>
        </p>
      </div>

      <div class="test-box">
        <h3>ğŸš€ Next Steps</h3>
        <p>If all tests pass, try the main app:</p>
        <a href="/" class="main-app-link">Go to Main App</a>
        <p>If any fail, we need to fix those issues first.</p>
      </div>
    </div>

    <script>
      // Device info
      document.getElementById("screen-size").textContent =
        window.innerWidth + "x" + window.innerHeight;
      document.getElementById("user-agent").textContent =
        navigator.userAgent.substring(0, 50) + "...";

      // Test functions
      function updateStatus(elementId, success, message) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = "status " + (success ? "success" : "error");
      }

      // Test basic JavaScript
      try {
        updateStatus("js-status", true, "âœ… Basic JS working");
      } catch (error) {
        updateStatus("js-status", false, "âŒ JS failed: " + error.message);
      }

      // Test frontend
      updateStatus("frontend-status", true, "âœ… Frontend loaded");

      // Test fetch API with timeout
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout

        fetch("http://192.168.0.115:8000/health", {
          signal: controller.signal,
          method: "GET",
          headers: {
            Accept: "application/json",
          },
        })
          .then((response) => {
            clearTimeout(timeoutId);
            if (response.ok) {
              return response.json();
            } else {
              throw new Error(
                `HTTP ${response.status}: ${response.statusText}`
              );
            }
          })
          .then((data) => {
            updateStatus("fetch-status", true, "âœ… Fetch API working");
            updateStatus("backend-status", true, "âœ… Backend connected");
          })
          .catch((error) => {
            clearTimeout(timeoutId);
            updateStatus(
              "fetch-status",
              false,
              "âŒ Fetch failed: " + error.message
            );
            updateStatus(
              "backend-status",
              false,
              "âŒ Backend failed: " + error.message
            );
          });
      } catch (error) {
        updateStatus("fetch-status", false, "âŒ Fetch error: " + error.message);
      }

      // Test Prophet service with timeout
      const prophetController = new AbortController();
      const prophetTimeoutId = setTimeout(
        () => prophetController.abort(),
        5000
      );

      fetch("http://192.168.0.115:8001/health", {
        signal: prophetController.signal,
        method: "GET",
        headers: {
          Accept: "application/json",
        },
      })
        .then((response) => {
          clearTimeout(prophetTimeoutId);
          if (response.ok) {
            return response.json();
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        })
        .then((data) => {
          updateStatus("prophet-status", true, "âœ… Prophet connected");
        })
        .catch((error) => {
          clearTimeout(prophetTimeoutId);
          updateStatus(
            "prophet-status",
            false,
            "âŒ Prophet failed: " + error.message
          );
        });

      // Test CSRF token with timeout
      const csrfController = new AbortController();
      const csrfTimeoutId = setTimeout(() => csrfController.abort(), 5000);

      fetch("http://192.168.0.115:8000/csrf", {
        signal: csrfController.signal,
        method: "GET",
        headers: {
          Accept: "application/json",
        },
      })
        .then((response) => {
          clearTimeout(csrfTimeoutId);
          if (response.ok) {
            return response.json();
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        })
        .then((data) => {
          updateStatus("csrf-status", true, "âœ… CSRF token received");
        })
        .catch((error) => {
          clearTimeout(csrfTimeoutId);
          updateStatus(
            "csrf-status",
            false,
            "âŒ CSRF failed: " + error.message
          );
        });

      // Test health endpoint with timeout
      const healthController = new AbortController();
      const healthTimeoutId = setTimeout(() => healthController.abort(), 5000);

      fetch("http://192.168.0.115:8000/health", {
        signal: healthController.signal,
        method: "GET",
        headers: {
          Accept: "application/json",
        },
      })
        .then((response) => {
          clearTimeout(healthTimeoutId);
          if (response.ok) {
            return response.json();
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        })
        .then((data) => {
          updateStatus("health-status", true, "âœ… Health check passed");
        })
        .catch((error) => {
          clearTimeout(healthTimeoutId);
          updateStatus(
            "health-status",
            false,
            "âŒ Health failed: " + error.message
          );
        });
    </script>
  </body>
</html>
