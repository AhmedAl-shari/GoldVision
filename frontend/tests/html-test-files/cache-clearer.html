<!DOCTYPE html>
<html>
  <head>
    <title>GoldVision Cache Clearer</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .button {
        background: #007bff;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 0;
      }
      .button:hover {
        background: #0056b3;
      }
      .status {
        margin: 20px 0;
        padding: 15px;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üßπ GoldVision Cache Clearer</h1>
      <p>
        This will completely clear all browser caches and reload the application
        with the correct API configuration.
      </p>

      <button class="button" onclick="clearAllCaches()">
        Clear All Caches & Reload
      </button>

      <div id="status"></div>

      <h3>What this does:</h3>
      <ul>
        <li>Clears localStorage and sessionStorage</li>
        <li>Removes all service workers</li>
        <li>Deletes all browser caches</li>
        <li>Clears IndexedDB</li>
        <li>Removes cookies</li>
        <li>Forces a hard reload</li>
      </ul>
    </div>

    <script>
      function showStatus(message, type = "success") {
        const status = document.getElementById("status");
        status.innerHTML = `<div class="status ${type}">${message}</div>`;
      }

      async function clearAllCaches() {
        showStatus("üßπ Starting cache clearing process...", "success");

        try {
          // Clear all storage
          localStorage.clear();
          sessionStorage.clear();
          showStatus("‚úÖ Cleared localStorage and sessionStorage", "success");

          // Clear IndexedDB
          if ("indexedDB" in window) {
            const databases = await indexedDB.databases();
            for (const db of databases) {
              indexedDB.deleteDatabase(db.name);
            }
            showStatus("‚úÖ Cleared IndexedDB", "success");
          }

          // Clear service workers
          if ("serviceWorker" in navigator) {
            const registrations =
              await navigator.serviceWorker.getRegistrations();
            for (const registration of registrations) {
              await registration.unregister();
            }
            showStatus("‚úÖ Unregistered service workers", "success");
          }

          // Clear all caches
          if ("caches" in window) {
            const names = await caches.keys();
            for (const name of names) {
              await caches.delete(name);
            }
            showStatus("‚úÖ Cleared all caches", "success");
          }

          // Clear cookies
          document.cookie.split(";").forEach((cookie) => {
            const eqPos = cookie.indexOf("=");
            const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
            document.cookie =
              name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
            document.cookie =
              name +
              "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=localhost";
            document.cookie =
              name +
              "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=127.0.0.1";
          });
          showStatus("‚úÖ Cleared cookies", "success");

          showStatus(
            "üéâ All caches cleared! Redirecting to GoldVision...",
            "success"
          );

          // Redirect to the main app
          setTimeout(() => {
            window.location.href = "http://127.0.0.1:5173";
          }, 2000);
        } catch (error) {
          showStatus(`‚ùå Error: ${error.message}`, "error");
        }
      }

      // Auto-run on page load
      window.onload = function () {
        showStatus("Ready to clear caches. Click the button above.", "success");
      };
    </script>
  </body>
</html>
